<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Upload and Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      line-height: 1.6;
    }
    h1 {
      color: #333;
    }
    input[type="file"] {
      margin: 10px 0;
    }
    #fileList a {
      text-decoration: none;
      color: #007BFF;
    }
    #fileList a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>File Upload and Viewer</h1>

  <!-- File Upload Form -->
  <form id="uploadForm">
    <input type="file" id="fileInput" />
    <button type="submit">Upload</button>
  </form>

  <h2>Uploaded Files</h2>
  <div id="fileList">Loading...</div>

  <script>
    const API_URL = "https://snazzy-stroopwafel-c31ef8.netlify.app/.netlify/functions/uploads";

    // Fetch and display the list of uploaded files
    function fetchFiles() {
      fetch(API_URL)
        .then((response) => response.json())
        .then((files) => {
          const fileList = document.getElementById("fileList");
          fileList.innerHTML = ""; // Clear previous list

          if (files.length === 0) {
            fileList.textContent = "No files uploaded yet.";
          } else {
            files.forEach((file) => {
              const link = document.createElement("a");
              link.href = `${API_URL}?file=${file}`; // Add ?file=filename to URL
              link.textContent = file;
              link.target = "_blank"; // Open in a new tab
              fileList.appendChild(link);
              fileList.appendChild(document.createElement("br"));
            });
          }
        })
        .catch((error) => {
          console.error("Error fetching file list:", error);
          document.getElementById("fileList").textContent =
            "Failed to load files. Please try again later.";
        });
    }

    // Handle file uploads
    document.getElementById("uploadForm").addEventListener("submit", (event) => {
      event.preventDefault(); // Prevent form from reloading the page
      const fileInput = document.getElementById("fileInput");

      if (!fileInput.files.length) {
        alert("Please select a file to upload.");
        return;
      }

      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append("file", file);

      fetch(API_URL, {
        method: "POST",
        headers: {
          "x-file-name": file.name,
        },
        body: file,
      })
        .then((response) => {
          if (response.ok) {
            alert(`File "${file.name}" uploaded successfully.`);
            fileInput.value = ""; // Clear the file input
            fetchFiles(); // Refresh the file list
          } else {
            alert("Failed to upload file. Please try again.");
          }
        })
        .catch((error) => {
          console.error("Error uploading file:", error);
          alert("An error occurred while uploading the file.");
        });
    });

    // Fetch the initial list of files on page load
    fetchFiles();
  </script>
</body>
</html>
